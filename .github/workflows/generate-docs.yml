name: Generate docs

on:
  pull_request:

jobs:
  docs:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        ref: ${{ github.event.pull_request.head.ref }}
        submodules: 'true'
      timeout-minutes: 2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.8

    - name: Install Dependencies
      run: pip install -r ./scripts/requirements.txt

    - name: Generate client header documents
      timeout-minutes: 4
      uses: terraform-docs/gh-actions@v1.0.0
      with:
        find-dir: modules/
        git-push: "true"
        config-file: ./docs/docs-auto-generate-configs/.header-terraform-docs.yml
        output-file: HEADER.md

    - name: Generate client documents
      timeout-minutes: 4
      uses: terraform-docs/gh-actions@v1.0.0
      with:
        find-dir: modules/
        git-push: "true"
        config-file: ./docs/docs-auto-generate-configs/.auto-generated-terraform-docs.yml
        output-file: AUTO-GENERATED.md

    - name: Copy autogenerated file to docs folder
      run: python ./scripts/copy_auto_generated_docs.py
